diff -crNB blocks-new/packages/dotlrn/www/admin/planner-enable.tcl blocks-clean/packages/dotlrn/www/admin/planner-enable.tcl
*** blocks-new/packages/dotlrn/www/admin/planner-enable.tcl	1969-12-31 19:00:00.000000000 -0500
--- blocks-clean/packages/dotlrn/www/admin/planner-enable.tcl	2009-07-05 22:16:44.000000000 -0400
***************
*** 0 ****
--- 1,20 ----
+ ad_page_contract {
+     Enable/Disable Block View in a community
+ 
+     @author Alvaro Rodriguez (alvaro@viaro.net)
+     @creation-date Jul-2008
+ } {
+     {enable_p "f"}
+     {return_url ""}
+ }
+ 
+ set user_id [ad_conn user_id]
+ set community_id [dotlrn_community::get_community_id]
+ # Permissions
+ dotlrn::require_user_admin_community -user_id $user_id -community_id $community_id
+ 
+ planner::enable -community_id $community_id -enable_p $enable_p
+ 
+ if {![empty_string_p $return_url]} {
+     ad_returnredirect $return_url
+ }
\ No newline at end of file
diff -crNB blocks-new/packages/dotlrn/www/index.tcl blocks-clean/packages/dotlrn/www/index.tcl
*** blocks-new/packages/dotlrn/www/index.tcl	2009-07-05 21:03:16.000000000 -0400
--- blocks-clean/packages/dotlrn/www/index.tcl	2009-07-08 12:58:22.000000000 -0400
***************
*** 25,30 ****
--- 25,40 ----
      {page_num 0}
  }
  
+ ## Planner redirect
+ if { $page_num == 0 } {
+     if {[apm_package_installed_p "planner"]} {
+         set planner_view [planner::enabled_p -community_id [dotlrn_community::get_community_id]]
+         if {[string equal $planner_view "t"]} {
+             ad_returnredirect "planner/"
+         }
+     }
+ }
+ 
  # Used to keep track of navigation links
  ad_set_client_property dotlrn page_num $page_num
  
